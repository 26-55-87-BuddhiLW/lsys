<html>
<head>
  <script type="text/javascript">
    function enhanceCanvas(){}
  </script>
</head>
<body>
  <div id="container" style="width:1000px; height:800px;">
  </div>

  <script type="text/javascript" src="../js/jquery-1.8.1.js"></script>
  <script type="text/javascript" src="../js/jquery.ellipsis.js"></script>
  <script type="text/javascript" src="../js/system-ticker.js"></script>
  <script type="text/javascript" src="../js/jquery.kinetic.js"></script>
  <script type="text/javascript" src="../js/jquery.cookie.js"></script>


  <script type="text/javascript" src="../js/underscore.js"></script>
  <script type="text/javascript" src="../js/bootstrap.js"></script>
  <script type="text/javascript" src="../js/api.js"></script>

  <script type="text/javascript" src="../js/generated/util.js"></script>
  <script type="text/javascript" src="../js/generated/controls.js"></script>
  <script type="text/javascript" src="../js/generated/lsystem.js"></script>
  <script type="text/javascript" src="../js/generated/compilation.js"></script>
  <script type="text/javascript" src="../js/generated/rendering.js"></script>
  <script type="text/javascript" src="../js/generated/manager.js"></script>

  <script>

    var systems = [
      "#?i=11&p.size=18.67&p.angle=-3787.3&r=L%20%3A%20SYS%0AS%20%3A%20F-%5BF-Y%5BS%5D%5D%0AY%20%3A%20%5B%7CFF%5B-((%3E%3E%3E%3E%3E%3ES%5D%2BY%5D",
      "#?i=40&p.size=4.44&p.angle=-2361.3&r=C%20%3A%20%5BB%5DC%0AB%20%3A%20!AFB)!A-%0AA%20%3A%20-AF%2B",
      "#?i=41&p.size=3.28&p.angle=-2756.2&r=L%20%3A%20SYL%0AS%20%3A%20F-%5BF-Y%5BS%2B%2BFFF%5B%2BF%2BF%5D%5D%0AY%20%3A%20F%5B%7CF!F%2BY%5D-F",
      "#?i=10&p.size=9.72&p.angle=-1194.3&r=A%20%3A%20FFFS%5B%2BA%5D%5B-A%5DFA%0AS%20%3A%20%3ES))"
    ];

    var renderer = new Renderer(Util.control('container'));
    var compiler = new SystemCompiler

    var iter = 5;

    
    systems.reduce(function(promise,systemText){
      var total = 0;
      return promise.pipe(function(){
        var system = LSystem.fromUrl(systemText);
        renderer.prepare(system);
        return compiler.compile(system).pipe(
          function(elems){
            for (var i = 0; i < iter; i++){
              var t = renderer.render(elems,system);
              total += t;
            }
            console.log(total / iter, "ms");
            return $.Deferred().resolve().promise();
          }
        )
      });
    }, $.Deferred().resolve().promise()).pipe(function(){ console.log('done') }, function(){ console.log('shit') });

  </script>
</body>
</html>
