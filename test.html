<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lsys</title>
    <link href="css/topcoat/css/normalize.css" rel="stylesheet" type="text/css"/>
    <link href="css/forkme.css" rel="stylesheet" type="text/css"/>
    <link href="css/fontello.css" rel="stylesheet" type="text/css"/>
    <link href="sass/test.css" rel="stylesheet" type="text/css"/>

    <!-- google analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-35201182-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
</head>
<body class="bg-slategray">

<div class="left">

    <div class="header">
        <a href="http://benvan.co.uk/lsys"><img src="img/logo_tr.png"><span>lsys</span></a>

    </div>
    <div class="controls">
        <ul>
            <li class="section">offsets</li>

            <li class="group" id="offsets-container">
                <ul class="labels">
                    <li>x</li><li>y</li><li>rotation</li>
                </ul>
                <!-- offsets be here! -->
            </li>

            <li class="section">variables</li>

            <li class="group" id="controls-container">
                <ul class="labels pair">
                    <li>value</li><!--
                 --><li>growth</li>
                </ul>
                <!-- controls be here! -->
            </li>

            <li class="section">sensitivities</li>

            <li class="group" id="sensitivities-container">
                <ul class="labels pair">
                    <li>value</li><!--
                 --><li>growth</li>
                </ul>
                <!-- sensitivities be here! -->
            </li>

            <li class="section">system</li>

            <li class="group">
                <ul class="control-row half">
                    <li class="label">levels</li><!--
                 --><li><input id="iterations" type="text" ></li>
                </ul>
                <ul class="control-row">
                    <li class="label">rules</li><!--
                 --><li><textarea id="rules" rows="12"></textarea></li>
                </ul>
                <div class="recalculate">
                    <button>recalculate</button>
                </div>
            </li>


        </ul>
    </div>

</div>
<div class="bottom bg-slategray">
    <footer class="ticker">
        <div class="ticker-bar"></div>
        <ul class="elems">
        </ul>
    </footer>
</div>
<div class="right">

    <div class="drawing-pad">
        <div id="systemInfo" class="system-info blue">
            <div id="systemName" class="system-name">click-and-drag!</div>
            <div class="actions">
                <a class="export" href="#">
                    <i class="icon-download"></i>
                </a>
            </div>
        </div>
        <div id="drawingContainer">
            <canvas id="c"></canvas>
        </div>
    </div>

    <div class="github-fork-ribbon-wrapper fm-left">
        <div class="github-fork-ribbon">
            <a href="https://github.com/benvan/lsys">Fork me on GitHub</a>
        </div>
    </div>

</div>

<script type="text/javascript" src="js/underscore.js"></script>
<script type="text/javascript" src="js/jquery-1.8.1.js"></script>

<script type="text/javascript" src="js/system-ticker.js"></script>

<script type="text/javascript" src="js/generated/util.js"></script>
<script type="text/javascript" src="js/generated/controls.js"></script>
<script type="text/javascript" src="js/generated/classes.js"></script>
<script type="text/javascript" src="js/generated/lsystem.js"></script>
<script type="text/javascript" src="js/generated/rendering.js"></script>
<script type="text/javascript" src="js/generated/manager.js"></script>
<script type="text/javascript">
    var manager; // Don't judge. I want to get ahold of it in the console!
    $(document).ready(function () {

        $(".elems").ticker("ticker.json");

        manager = new SystemManager(
            Util.control("c"),
            Util.map({
                params: 'controls-container',
                offsets: 'offsets-container',
                sensitivities: 'sensitivities-container',
                iterations: 'iterations',
                rules: 'rules'
            }, Util.control)
        );

        manager.run();

        var stretchCanvas = function(){
            var canvas = Util.control("c");
            window.container = Util.control("drawingContainer");
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        };

        stretchCanvas();
        $(window).resize(function(){
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(function(){
                stretchCanvas();
                manager.draw()
            },300);
        });

        var update = function(){
            manager.updateFromControls();
            manager.draw();
        };

        $('a.export').click(function(){
            manager.exportToPng();
            return false;
        });

        //this is kinda naughty... but I'd rather refactor Controls first than fudge this in otherwise
        $("#controls-container,#offsets-container").find("[data-param]").on("input", _.debounce(update, 250));

        $("#sensitivities-container").find("[data-param]").on("input", function(){
            manager.updateFromControls();
        });

        $('#rules,#iterations').on('input', function(){
            $('.recalculate button').fadeIn(100);
        });
        $('.recalculate button')
                .hide()
                .click(update)
                .click(function(){
                    $(this).fadeOut(100)
                });

        manager.draw();
    });


</script>


</body>
</html>
